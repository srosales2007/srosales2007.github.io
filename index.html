<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Station: Tetris | Calcu | Snake</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Fredoka+One&family=Roboto:wght@400;700&display=swap');

        body {
            margin: 0;
            overflow-x: hidden; /* Evitar scroll horizontal */
            background-color: #10002b; /* Fondo muy oscuro */
            font-family: 'Roboto', sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- 3D BACKGROUND --- */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* --- MAIN LAYOUT --- */
        .arcade-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            max-width: 1200px;
        }

        /* Estilo común para los paneles (Glassmorphism) */
        .panel {
            background: rgba(36, 0, 70, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(157, 78, 221, 0.5);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(123, 44, 191, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            color: #e0aaff;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #7b2cbf;
            text-align: center;
        }

        .controls-hint {
            font-size: 10px;
            color: #9d4edd;
            margin-bottom: 10px;
            text-align: center;
        }

        /* --- JUEGOS CANVAS --- */
        canvas {
            background-color: #000;
            border: 2px solid #5a189a;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(90, 24, 154, 0.5);
        }

        /* --- CALCULADORA (Estilos previos) --- */
        .calculator {
            width: 280px;
        }
        .screen {
            width: 100%;
            background-color: #10002b;
            color: #e0aaff;
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            text-align: right;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #5a189a;
            box-sizing: border-box;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        button {
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: 0.1s;
        }
        button:active { transform: scale(0.95); }
        .btn-num { background-color: #5a189a; color: white; }
        .btn-num:hover { background-color: #7b2cbf; }
        .btn-op { background-color: #9d4edd; color: #10002b; }
        .btn-eq { background-color: #ff006e; color: white; grid-column: span 2; }
        .btn-clear { background-color: #3c096c; color: #ff9e00; }

    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div class="arcade-container">
        
        <div class="panel">
            <h2>TETRIS</h2>
            <div class="controls-hint">Usa: W, A, S, D</div>
            <canvas id="tetris" width="200" height="400"></canvas>
            <button onclick="resetTetris()" style="margin-top:10px; font-size:10px; padding:5px; background:#ff006e; color:white;">Reiniciar</button>
            <div id="tetris-score" style="margin-top:5px; font-family:'Press Start 2P'; font-size:10px;">Score: 0</div>
        </div>

        <div class="panel calculator">
            <h2>CALCU</h2>
            <div class="controls-hint">Click para usar</div>
            <div class="screen" id="display">0</div>
            <div class="buttons">
                <button class="btn-clear" onclick="clearDisplay()">C</button>
                <button class="btn-op" onclick="appendOperator('/')">/</button>
                <button class="btn-op" onclick="appendOperator('*')">x</button>
                <button class="btn-op" onclick="deleteLast()">←</button>
                
                <button class="btn-num" onclick="appendNumber('7')">7</button>
                <button class="btn-num" onclick="appendNumber('8')">8</button>
                <button class="btn-num" onclick="appendNumber('9')">9</button>
                <button class="btn-op" onclick="appendOperator('-')">-</button>
                
                <button class="btn-num" onclick="appendNumber('4')">4</button>
                <button class="btn-num" onclick="appendNumber('5')">5</button>
                <button class="btn-num" onclick="appendNumber('6')">6</button>
                <button class="btn-op" onclick="appendOperator('+')">+</button>
                
                <button class="btn-num" onclick="appendNumber('1')">1</button>
                <button class="btn-num" onclick="appendNumber('2')">2</button>
                <button class="btn-num" onclick="appendNumber('3')">3</button>
                
                <button class="btn-num" onclick="appendNumber('0')">0</button>
                <button class="btn-num" onclick="appendNumber('.')">.</button>
                <button class="btn-eq" onclick="calculate()">=</button>
            </div>
        </div>

        <div class="panel">
            <h2>SNAKE</h2>
            <div class="controls-hint">Usa: Flechas ⬆⬇⬅➡</div>
            <canvas id="snake" width="200" height="400"></canvas>
            <button onclick="resetSnake()" style="margin-top:10px; font-size:10px; padding:5px; background:#ff006e; color:white;">Reiniciar</button>
            <div id="snake-score" style="margin-top:5px; font-family:'Press Start 2P'; font-size:10px;">Score: 0</div>
        </div>

    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.150.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x10002b, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 10;

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Formas geométricas abstractas flotantes
        const geometry = new THREE.IcosahedronGeometry(1, 0);
        const material = new THREE.MeshNormalMaterial({ wireframe: true }); 
        // Usamos MeshNormal para que tenga colores "tech" automáticos morados/azules

        const shapes = [];
        
        for (let i = 0; i < 30; i++) {
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.x = (Math.random() - 0.5) * 30;
            mesh.position.y = (Math.random() - 0.5) * 30;
            mesh.position.z = (Math.random() - 0.5) * 10;
            mesh.rotation.x = Math.random() * Math.PI;
            scene.add(mesh);
            shapes.push({ 
                mesh, 
                rotX: (Math.random()-0.5) * 0.02, 
                rotY: (Math.random()-0.5) * 0.02 
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            shapes.forEach(item => {
                item.mesh.rotation.x += item.rotX;
                item.mesh.rotation.y += item.rotY;
            });
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

    <script>
        // --- 1. CALCULADORA ---
        let display = document.getElementById('display');
        let currentInput = '';

        function appendNumber(num) {
            if (currentInput === '0' && num !== '.') currentInput = '';
            currentInput += num;
            updateScreen();
        }
        function appendOperator(op) {
            const last = currentInput.slice(-1);
            if (['+','-','*','/'].includes(last)) return;
            currentInput += op;
            updateScreen();
        }
        function clearDisplay() { currentInput = '0'; updateScreen(); }
        function deleteLast() {
            currentInput = currentInput.toString().slice(0, -1);
            if (!currentInput) currentInput = '0';
            updateScreen();
        }
        function calculate() {
            try { currentInput = eval(currentInput).toString(); updateScreen(); }
            catch { currentInput = 'Error'; updateScreen(); setTimeout(clearDisplay, 1000); }
        }
        function updateScreen() { display.innerText = currentInput; }


        // --- 2. SNAKE (Juego de la Serpiente) ---
        const cvsSnake = document.getElementById("snake");
        const ctxSnake = cvsSnake.getContext("2d");
        const box = 20; // Tamaño de celda
        let snake = [];
        snake[0] = { x: 5 * box, y: 10 * box };
        let food = { x: Math.floor(Math.random()*10)*box, y: Math.floor(Math.random()*20)*box };
        let scoreSnake = 0;
        let d;
        let gameSnake;

        document.addEventListener("keydown", direction);

        function direction(event) {
            if(event.keyCode == 37 && d != "RIGHT") d = "LEFT";
            else if(event.keyCode == 38 && d != "DOWN") d = "UP";
            else if(event.keyCode == 39 && d != "LEFT") d = "RIGHT";
            else if(event.keyCode == 40 && d != "UP") d = "DOWN";
        }

        function drawSnake() {
            ctxSnake.fillStyle = "#10002b"; // Fondo
            ctxSnake.fillRect(0, 0, 200, 400);

            for(let i = 0; i < snake.length; i++) {
                ctxSnake.fillStyle = (i == 0) ? "#ff006e" : "#e0aaff"; // Cabeza rosa, cuerpo lila
                ctxSnake.fillRect(snake[i].x, snake[i].y, box, box);
                ctxSnake.strokeStyle = "#10002b";
                ctxSnake.strokeRect(snake[i].x, snake[i].y, box, box);
            }

            ctxSnake.fillStyle = "#3a86ff"; // Comida azul
            ctxSnake.fillRect(food.x, food.y, box, box);

            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if(d == "LEFT") snakeX -= box;
            if(d == "UP") snakeY -= box;
            if(d == "RIGHT") snakeX += box;
            if(d == "DOWN") snakeY += box;

            // Comer
            if(snakeX == food.x && snakeY == food.y) {
                scoreSnake++;
                document.getElementById('snake-score').innerText = "Score: " + scoreSnake;
                food = {
                    x: Math.floor(Math.random()*10) * box,
                    y: Math.floor(Math.random()*20) * box
                }
            } else {
                snake.pop();
            }

            // Game Over (Paredes o cuerpo)
            if(snakeX < 0 || snakeX > 19 * box || snakeY < 0 || snakeY > 19 * box || collision(snakeX, snakeY, snake)) {
                clearInterval(gameSnake);
                ctxSnake.fillStyle = "white";
                ctxSnake.font = "20px 'Press Start 2P'";
                ctxSnake.fillText("Perdiste", 20, 200);
                return;
            }

            let newHead = { x: snakeX, y: snakeY };
            snake.unshift(newHead);
        }

        function collision(headX, headY, array) {
            for(let i = 0; i < array.length; i++) {
                if(headX == array[i].x && headY == array[i].y) return true;
            }
            return false;
        }

        function resetSnake() {
            clearInterval(gameSnake);
            snake = [];
            snake[0] = { x: 5 * box, y: 10 * box };
            scoreSnake = 0;
            document.getElementById('snake-score').innerText = "Score: 0";
            d = null;
            gameSnake = setInterval(drawSnake, 150); // Velocidad
        }
        resetSnake();


        // --- 3. TETRIS (Simplificado) ---
        const cvsTetris = document.getElementById("tetris");
        const ctxTetris = cvsTetris.getContext("2d");
        const ROW = 20;
        const COL = 10;
        const SQ = 20;
        const VACANT = "#10002b";

        let board = [];
        for(let r = 0; r < ROW; r++){
            board[r] = [];
            for(let c = 0; c < COL; c++){
                board[r][c] = VACANT;
            }
        }

        function drawSquare(x,y,color){
            ctxTetris.fillStyle = color;
            ctxTetris.fillRect(x*SQ,y*SQ,SQ,SQ);
            ctxTetris.strokeStyle = "#5a189a";
            ctxTetris.strokeRect(x*SQ,y*SQ,SQ,SQ);
        }

        function drawBoard(){
            for(let r = 0; r < ROW; r++){
                for(let c = 0; c < COL; c++){
                    drawSquare(c,r,board[r][c]);
                }
            }
        }
        drawBoard();

        const PIECES = [
            [Z,"#ff006e"], [S,"#3a86ff"], [T,"#ffbe0b"], [O,"#fb5607"], [L,"#8338ec"], [I,"#3a0ca3"], [J,"#e0aaff"]
        ];

        // Definición de piezas (matrices 0/1)
        var Z = [[[1,1,0],[0,1,1],[0,0,0]], [[0,0,1],[0,1,1],[0,1,0]], [[0,0,0],[1,1,0],[0,1,1]], [[0,1,0],[1,1,0],[1,0,0]]];
        var S = [[[0,1,1],[1,1,0],[0,0,0]], [[0,1,0],[0,1,1],[0,0,1]], [[0,0,0],[0,1,1],[1,1,0]], [[1,0,0],[1,1,0],[0,1,0]]];
        var T = [[[0,1,0],[1,1,1],[0,0,0]], [[0,1,0],[0,1,1],[0,1,0]], [[0,0,0],[1,1,1],[0,1,0]], [[0,1,0],[1,1,0],[0,1,0]]];
        var O = [[[0,0,0],[0,1,1],[0,1,1]], [[0,0,0],[0,1,1],[0,1,1]], [[0,0,0],[0,1,1],[0,1,1]], [[0,0,0],[0,1,1],[0,1,1]]];
        var L = [[[0,0,1],[1,1,1],[0,0,0]], [[0,1,0],[0,1,0],[0,1,1]], [[0,0,0],[1,1,1],[1,0,0]], [[1,1,0],[0,1,0],[0,1,0]]];
        var I = [[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]], [[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]], [[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]], [[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]];
        var J = [[[1,0,0],[1,1,1],[0,0,0]], [[0,1,1],[0,1,0],[0,1,0]], [[0,0,0],[1,1,1],[0,0,1]], [[0,1,0],[0,1,0],[1,1,0]]];

        // Hack para asignar variables después de definir
        PIECES[0][0]=Z; PIECES[1][0]=S; PIECES[2][0]=T; PIECES[3][0]=O; PIECES[4][0]=L; PIECES[5][0]=I; PIECES[6][0]=J;

        let p; 
        let scoreTetris = 0;

        function randomPiece(){
            let r = Math.floor(Math.random() * PIECES.length); 
            return new Piece( PIECES[r][0],PIECES[r][1]);
        }

        function Piece(tetromino,color){
            this.tetromino = tetromino;
            this.color = color;
            this.tetrominoN = 0; 
            this.activeTetromino = this.tetromino[this.tetrominoN];
            this.x = 3;
            this.y = -2;
        }

        Piece.prototype.fill = function(color){
            for(let r = 0; r < this.activeTetromino.length; r++){
                for(let c = 0; c < this.activeTetromino.length; c++){
                    if(this.activeTetromino[r][c]){
                        drawSquare(this.x + c,this.y + r, color);
                    }
                }
            }
        }

        Piece.prototype.draw = function(){ this.fill(this.color); }
        Piece.prototype.unDraw = function(){ this.fill(VACANT); }

        Piece.prototype.moveDown = function(){
            if(!this.collision(0,1,this.activeTetromino)){
                this.unDraw();
                this.y++;
                this.draw();
            }else{
                this.lock();
                p = randomPiece();
            }
        }

        Piece.prototype.moveRight = function(){
            if(!this.collision(1,0,this.activeTetromino)){
                this.unDraw();
                this.x++;
                this.draw();
            }
        }
        Piece.prototype.moveLeft = function(){
            if(!this.collision(-1,0,this.activeTetromino)){
                this.unDraw();
                this.x--;
                this.draw();
            }
        }
        Piece.prototype.rotate = function(){
            let nextPattern = this.tetromino[(this.tetrominoN + 1)%this.tetromino.length];
            let kick = 0;
            if(this.collision(0,0,nextPattern)){
                if(this.x > COL/2) kick = -1; else kick = 1;
            }
            if(!this.collision(kick,0,nextPattern)){
                this.unDraw();
                this.x += kick;
                this.tetrominoN = (this.tetrominoN + 1)%this.tetromino.length; 
                this.activeTetromino = this.tetromino[this.tetrominoN];
                this.draw();
            }
        }

        Piece.prototype.collision = function(x,y,piece){
            for(let r = 0; r < piece.length; r++){
                for(let c = 0; c < piece.length; c++){
                    if(!piece[r][c]) continue;
                    let newX = this.x + c + x;
                    let newY = this.y + r + y;
                    if(newX < 0 || newX >= COL || newY >= ROW) return true;
                    if(newY < 0) continue;
                    if(board[newY][newX] != VACANT) return true;
                }
            }
            return false;
        }

        Piece.prototype.lock = function(){
            for(let r = 0; r < this.activeTetromino.length; r++){
                for(let c = 0; c < this.activeTetromino.length; c++){
                    if(!this.activeTetromino[r][c]) continue;
                    if(this.y + r < 0){
                        // Game Over
                        clearInterval(gameTetris);
                        document.getElementById('tetris-score').innerText = "Game Over";
                        return;
                    }
                    board[this.y+r][this.x+c] = this.color;
                }
            }
            // Eliminar filas
            for(let r = 0; r < ROW; r++){
                let isRowFull = true;
                for(let c = 0; c < COL; c++){
                    isRowFull = isRowFull && (board[r][c] != VACANT);
                }
                if(isRowFull){
                    for(let y = r; y > 1; y--){
                        for(let c = 0; c < COL; c++){
                            board[y][c] = board[y-1][c];
                        }
                    }
                    for(let c = 0; c < COL; c++) board[0][c] = VACANT;
                    scoreTetris += 10;
                    document.getElementById('tetris-score').innerText = "Score: " + scoreTetris;
                }
            }
            drawBoard();
        }

        // CONTROLES TETRIS (WASD)
        document.addEventListener("keydown", function(e){
            if(e.keyCode == 65) p.moveLeft(); // A
            else if(e.keyCode == 87) p.rotate();    // W
            else if(e.keyCode == 68) p.moveRight(); // D
            else if(e.keyCode == 83) p.moveDown();  // S
        });

        let dropStart = Date.now();
        let gameTetris;
        function drop(){
            let now = Date.now();
            let delta = now - dropStart;
            if(delta > 1000){
                p.moveDown();
                dropStart = Date.now();
            }
            if(document.getElementById('tetris-score').innerText !== "Game Over")
                gameTetris = requestAnimationFrame(drop);
        }

        function resetTetris() {
            cancelAnimationFrame(gameTetris);
            board = [];
            for(let r = 0; r < ROW; r++){
                board[r] = [];
                for(let c = 0; c < COL; c++) board[r][c] = VACANT;
            }
            drawBoard();
            scoreTetris = 0;
            document.getElementById('tetris-score').innerText = "Score: 0";
            p = randomPiece();
            drop();
        }
        resetTetris();

    </script>
</body>
</html>
